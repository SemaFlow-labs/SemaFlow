name: orders
data_source: duckdb_local
table: orders
primary_key: id
time_dimension: created_at
dimensions:
  id:
    expression: id
    description: Order primary key
  customer_id:
    expression: customer_id
    description: Foreign key to customers
  created_at:
    expression: created_at
    description: Order timestamp
measures:
  order_total:
    expr: amount
    agg: sum
    description: Total order amount
  order_count:
    expr: id
    agg: count
    description: Count of orders
  distinct_customers:
    expr: customer_id
    agg: count_distinct
    description: Distinct customers ordering
  us_order_total:
    expr: amount
    agg: sum
    filter: "customer_id == 1"
    description: Orders for customer_id 1
  avg_order_amount:
    expr: amount
    agg: sum
    post_expr: "safe_divide(order_total, order_count)"
    description: Average order amount (safe divide)
